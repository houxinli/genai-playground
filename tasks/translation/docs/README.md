# ç¿»è¯‘ä»»åŠ¡ä½¿ç”¨æŒ‡å—

## ğŸ¯ ä»»åŠ¡æ¦‚è¿°

æœ¬ä»»åŠ¡å®ç°äº†åŸºäº vLLM + Qwen3-4B çš„æœ¬åœ°æœºå™¨ç¿»è¯‘æœåŠ¡ï¼Œæ”¯æŒæ—¥è¯­åˆ°ä¸­æ–‡çš„ç¿»è¯‘ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
tasks/translation/
â”œâ”€â”€ translate                   # å¯æ‰§è¡ŒåŒ…è£…å™¨ï¼ˆè°ƒç”¨ src/translate.pyï¼‰
â”œâ”€â”€ src/                        # ç¿»è¯‘ç³»ç»Ÿæºç 
â”‚   â”œâ”€â”€ translate.py           # ä¸»å…¥å£ï¼ˆæ¨¡å—åŒ–ï¼‰
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒç¿»è¯‘æ¨¡å—
â”‚   â””â”€â”€ cli/                   # å‘½ä»¤è¡Œæ¥å£
â”œâ”€â”€ scripts/                    # è¾…åŠ©è„šæœ¬ï¼ˆé src/ ä¸‹ï¼‰
â”‚   â”œâ”€â”€ cleanup_bad_outputs.py # æ¸…ç†å¼‚å¸¸åŒè¯­è¾“å‡º
â”‚   â””â”€â”€ README.md              # è„šæœ¬è¯´æ˜
â”œâ”€â”€ docs/                       # ç¿»è¯‘ä»»åŠ¡æ–‡æ¡£
â”‚   â””â”€â”€ README.md              # æœ¬æ–‡ä»¶
â”œâ”€â”€ data/                       # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ debug/                 # è°ƒè¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ samples/               # ç¤ºä¾‹æ–‡ä»¶
â”‚   â””â”€â”€ terminology.txt        # æœ¯è¯­å¯¹ç…§è¡¨
â””â”€â”€ logs/                       # æ—¥å¿—ç›®å½•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ç¿»è¯‘æœåŠ¡
```bash
# ä½¿ç”¨ä¸»é¡¹ç›®çš„ç®¡ç†è„šæœ¬
make vllm-start

# æˆ–ç›´æ¥ä½¿ç”¨æœåŠ¡è„šæœ¬
./scripts/serve_vllm.sh
```

### 2. æµ‹è¯•ç¿»è¯‘åŠŸèƒ½
```bash
# ä½¿ç”¨ä¸»é¡¹ç›®çš„æµ‹è¯•å‘½ä»¤
make vllm-test

# æˆ–ç›´æ¥è¿è¡Œæµ‹è¯•è„šæœ¬
python -m src.scripts.test_translation --input input.txt --output output.txt
```

### 3. æ‰¹é‡/å¤šæ–‡ä»¶ç¿»è¯‘ï¼ˆç¤ºä¾‹ï¼‰
```bash
# æ¨èï¼šé€šè¿‡å¯æ‰§è¡ŒåŒ…è£…å™¨ï¼ˆç­‰ä»·äº python src/translate.pyï¼‰
./translate input1.txt input2.txt --bilingual-simple --stream

# æˆ–ç›´æ¥è°ƒç”¨æ¨¡å—å…¥å£
python -m src.translate input_dir_or_files --bilingual-simple --stream
```

## ğŸ§­ å…¥å£ä¸è°ƒç”¨æ–¹å¼

- translateï¼ˆå¯æ‰§è¡Œï¼‰
  - ä½ç½®ï¼š`tasks/translation/translate`
  - ä½œç”¨ï¼šä¾¿æ·åŒ…è£…å™¨ï¼Œå†…éƒ¨è°ƒç”¨ `python src/translate.py "$@"`
  - é€‚åˆï¼šå‘½ä»¤è¡Œå¿«é€Ÿä½¿ç”¨ã€è„šæœ¬åŒ–è°ƒç”¨

- src/translate.pyï¼ˆæ¨¡å—å…¥å£ï¼‰
  - ä½ç½®ï¼š`tasks/translation/src/translate.py`
  - ä½œç”¨ï¼šæ­£å¼å…¥å£ï¼Œè§£æ CLIï¼ˆ`src/cli`ï¼‰ï¼Œæ„å»ºé…ç½®å¹¶è¿è¡Œ `TranslationPipeline`
  - é€‚åˆï¼šä½œä¸ºæ¨¡å—è¢«å…¶ä»– Python ä»£ç è°ƒç”¨ï¼Œæˆ–é€šè¿‡ `python -m src.translate` ä½¿ç”¨

ä¸¤è€…åŠŸèƒ½ç­‰ä»·ï¼Œæ¨èä¼˜å…ˆä½¿ç”¨ `./translate` ä»¥è·å¾—æ›´çŸ­çš„å‘½ä»¤ï¼›åœ¨éœ€è¦ä»å…¶ä»– Python ä»£ç è°ƒç”¨æ—¶ï¼Œä½¿ç”¨ `src/translate.py`ã€‚

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç®€å•ç¿»è¯‘æµ‹è¯•
```python
import requests

def translate_japanese_to_chinese(text):
    url = "http://localhost:8000/v1/chat/completions"
    data = {
        "model": "Qwen/Qwen3-4B",
        "messages": [
            {"role": "system", "content": "ä½ æ˜¯æ—¥è¯­ç¿»è¯‘åŠ©æ‰‹"},
            {"role": "user", "content": f"ç¿»è¯‘ï¼š{text}"}
        ],
        "max_tokens": 1000
    }
    
    response = requests.post(url, json=data)
    return response.json()['choices'][0]['message']['content']

# æµ‹è¯•
result = translate_japanese_to_chinese("ã“ã‚“ã«ã¡ã¯ã€ä¸–ç•Œã€‚")
print(result)  # è¾“å‡º: ä½ å¥½ï¼Œä¸–ç•Œã€‚
```

## ğŸ”§ é…ç½®è¯´æ˜

### æœåŠ¡é…ç½®
- **æ¨¡å‹**: Qwen/Qwen3-4B-Thinking-2507-FP8
- **ç«¯å£**: 8000
- **æœ€å¤§é•¿åº¦**: 40960
- **æ˜¾å­˜åˆ©ç”¨ç‡**: 90%

### ç¯å¢ƒè¦æ±‚
- CUDA 12.4
- Python 3.10
- vLLM 0.10.1.1
- 4Ã— RTX 6000 Ada GPU

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### æµ‹è¯•ç»“æœ
- âœ… `ã“ã‚“ã«ã¡ã¯ã€ä¸–ç•Œã€‚` â†’ `ä½ å¥½ï¼Œä¸–ç•Œã€‚`
- âœ… `ä»Šæ—¥ã¯è‰¯ã„å¤©æ°—ã§ã™ã­ã€‚` â†’ `ä»Šå¤©å¤©æ°”çœŸå¥½ã€‚`
- âœ… `ç§ã¯æ—¥æœ¬èªã‚’å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚` â†’ `æˆ‘æ­£åœ¨å­¦ä¹ æ—¥è¯­ã€‚`

### å“åº”æ—¶é—´
- API å“åº”: < 1ç§’
- ç¿»è¯‘è´¨é‡: ä¼˜ç§€
- æ¨¡å‹æ¨ç†: åŒ…å«æ€è€ƒè¿‡ç¨‹

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æœåŠ¡å¯åŠ¨å¤±è´¥**: æ£€æŸ¥ CUDA ç¯å¢ƒå˜é‡è®¾ç½®
2. **ç¿»è¯‘è´¨é‡å·®**: è°ƒæ•´ç³»ç»Ÿæç¤ºè¯
3. **å“åº”è¶…æ—¶**: æ£€æŸ¥æ¨¡å‹åŠ è½½çŠ¶æ€

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
make vllm-logs

# æŸ¥çœ‹ç¿»è¯‘è„šæœ¬æ—¥å¿—
tail -f tasks/translation/logs/translation.log
```

## ğŸ”® æ‰©å±•åŠŸèƒ½

### è®¡åˆ’ä¸­çš„åŠŸèƒ½
1. **å¤šè¯­è¨€æ”¯æŒ**: æ·»åŠ å…¶ä»–è¯­è¨€å¯¹
2. **æ‰¹é‡å¤„ç†**: æ”¯æŒæ–‡ä»¶æ‰¹é‡ç¿»è¯‘
3. **è´¨é‡è¯„ä¼°**: æ·»åŠ ç¿»è¯‘è´¨é‡è¯„ä¼°
4. **Web ç•Œé¢**: ç®€å•çš„ Web ç¿»è¯‘ç•Œé¢

### æŠ€æœ¯å‡çº§
1. **æ¨¡å‹å‡çº§**: å°è¯•æ›´å¤§çš„æ¨¡å‹
2. **å¤šå¡å¹¶è¡Œ**: å……åˆ†åˆ©ç”¨ 4 å¡èµ„æº
3. **ç¼“å­˜ä¼˜åŒ–**: æ·»åŠ ç¿»è¯‘ç»“æœç¼“å­˜

---

**æœ€åæ›´æ–°**: 2025-09-08
